/*
  WS_EST.cpp 
*/

#include "Arduino.h"
#include "WS_EST_ptr.h"

WindspeedEstimation::WindspeedEstimation(uint16_t *rpm, float *theta, uint16_t *l_current, uint16_t *l_voltage, uint16_t *l_power)
{
    _ptrrpm = rpm;
    _ptrtheta = theta;
    _ptrl_voltage = l_voltage;
    _ptrl_current = l_current;
    _ptrl_power = l_power;
}

void WindspeedEstimation::updateVars()
{
    _rpm = (double)*_ptrrpm;
    _theta = (double)*_ptrtheta;
    _l_voltage = (double)*_ptrl_voltage;
    _l_current = (double)*_ptrl_current;
    _l_power = (double)*_ptrl_power;
}

double WindspeedEstimation::linear()
{
    updateVars();
    return 0.00328831124563338*(_rpm)
            + 0.0236602202015669*(_l_voltage)
            + -0.0591897365414463*(_l_current)
            + 0.128589853702955*(_theta)
            + -0.000239889103686202*(_l_power);
}

double WindspeedEstimation::secondOrder()
{
    updateVars();
    return -2.2072515
            + 0.0*(1)
            + 0.03016279*(_rpm)
            + -0.00182036*(_theta)
            + -0.0035850275*(_l_current)
            + -0.008176723*(_l_voltage)
            + 5.0407834e-06*(pow(_rpm, 2))
            + -0.0006336755*(_rpm*_theta)
            + 0.00024348474*(_rpm*_l_current)
            + -0.000100869685*(_rpm*_l_voltage)
            + 0.0037005555*(pow(_theta, 2))
            + -0.0011665636*(_theta*_l_current)
            + 0.000711424*(_theta*_l_voltage)
            + 0.001034786*(pow(_l_current, 2))
            + -0.00090177264*(_l_current*_l_voltage)
            + 0.00019574724*(pow(_l_voltage, 2));
}

double WindspeedEstimation::bestFit()
{
    updateVars();
    return 3.9828371113509036
 + 9.377825161952790410817295268004422877962389382133778781280852854251861572265625E-13*(1)
 + -1.855988011984380738856139671233425048058052198030054569244384765625E-7*(_rpm)
 + 1.3117514132696636214718867238120982021687410679078311659395694732666015625E-10*(_theta)
 + -4.255916009508512164100766284220711543895276918192394077777862548828125E-9*(_l_current)
 + -8.524058350827242155776776000135341870844740697066299617290496826171875E-9*(_l_voltage)
 + 2.13547487465587295905414537584843248652077818405814468860626220703125E-7*(pow(_rpm, 2))
 + -1.48334217298701327877763381062059533377350817318074405193328857421875E-7*(_rpm*_theta)
 + 8.396372922089787413474598447293839598160047899000346660614013671875E-8*(_rpm*_l_current)
 + 2.501075677428473351601441281022442097992097842507064342498779296875E-7*(_rpm*_l_voltage)
 + -5.297633910035831273762567221463637423539694282226264476776123046875E-9*(pow(_theta, 2))
 + -1.31897813860764665760860379038754697234026025398634374141693115234375E-7*(_theta*_l_current)
 + -3.3369536720394404600946447470022349079954437911510467529296875E-7*(_theta*_l_voltage)
 + 3.142225766231210891659208855018758921318067223182879388332366943359375E-8*(pow(_l_current, 2))
 + 8.43790419847280861675672437860473706905395374633371829986572265625E-8*(_l_current*_l_voltage)
 + 2.27607208090749119432948436268782099745067171170376241207122802734375E-7*(pow(_l_voltage, 2))
 + 9.020594122123402047516292807938231845810150844044983386993408203125E-7*(pow(_rpm, 3))
 + 7.30321433991569353483657160881759029535942318034358322620391845703125E-8*(pow(_rpm, 2)*_theta)
 + -8.27214871875208381164258641948805461652227677404880523681640625E-7*(pow(_rpm, 2)*_l_current)
 + -8.397482439697661861648949298275734776098033762536942958831787109375E-7*(pow(_rpm, 2)*_l_voltage)
 + -0.00000354815507079345518809594152431774460865199216641485691070556640625*(_rpm*pow(_theta, 2))
 + 5.06545489344988142678383701011934903135625063441693782806396484375E-8*(_rpm*_theta*_l_current)
 + -1.02592902071164508125447376138579536064554531549219973385334014892578125E-8*(_rpm*_theta*_l_voltage)
 + 1.6093129419280575019787792902248302340240115881897509098052978515625E-7*(_rpm*pow(_l_current, 2))
 + 1.91510963207377671811197064784260124525872015510685741901397705078125E-7*(_rpm*_l_current*_l_voltage)
 + 3.987657136253718662065553650364346793821823666803538799285888671875E-7*(_rpm*pow(_l_voltage, 2))
 + -6.690513503694364895406213912532056298232419067062437534332275390625E-8*(pow(_theta, 3))
 + -0.00000319893268543903439918838806088619008960449718870222568511962890625*(pow(_theta, 2)*_l_current)
 + -0.000008003608823685150807443651477246504555296269245445728302001953125*(pow(_theta, 2)*_l_voltage)
 + 5.467399996614110044325656086183773396669494104571640491485595703125E-7*(_theta*pow(_l_current, 2))
 + 6.493122355602775562285881340296445074500297778286039829254150390625E-7*(_theta*_l_current*_l_voltage)
 + -3.039543271457806086925982312629823667293749167583882808685302734375E-7*(_theta*pow(_l_voltage, 2))
 + 7.4880228894176153510509942080874967729187119402922689914703369140625E-8*(pow(_l_current, 3))
 + 4.669149998317572692981526302248573845332657583639957010746002197265625E-8*(pow(_l_current, 2)*_l_voltage)
 + -6.0922585180576385513936672581880582555413639056496322154998779296875E-8*(_l_current*pow(_l_voltage, 2))
 + -5.882698794684125523485307938942323602304895757697522640228271484375E-8*(pow(_l_voltage, 3))
 + 4.488476720980508116102918048095915537487599067389965057373046875E-9*(pow(_rpm, 4))
 + -1.797647928756728602167429785507746231587589136324822902679443359375E-7*(pow(_rpm, 3)*_theta)
 + -2.3384456822499702607670753196078550217862357385456562042236328125E-8*(pow(_rpm, 3)*_l_current)
 + 1.67977839614887999235108562157137157555553130805492401123046875E-9*(pow(_rpm, 3)*_l_voltage)
 + 0.000001822052270842570528722008382782604485328192822635173797607421875*(pow(_rpm, 2)*pow(_theta, 2))
 + -4.7560966483208838161307607794725527128321118652820587158203125E-8*(pow(_rpm, 2)*_theta*_l_current)
 + 2.3367040701091941406011311122004059370738104917109012603759765625E-7*(pow(_rpm, 2)*_theta*_l_voltage)
 + 3.7515336026046134084167816245825033405481008230708539485931396484375E-8*(pow(_rpm, 2)*pow(_l_current, 2))
 + 4.51001905619618395260777589383938135370044619776308536529541015625E-9*(pow(_rpm, 2)*_l_current*_l_voltage)
 + -2.805161212996154959892040892110998129282961599528789520263671875E-9*(pow(_rpm, 2)*pow(_l_voltage, 2))
 + -0.000002237910843860376939283562958138418252929113805294036865234375*(_rpm*pow(_theta, 3))
 + -0.00000541753598079213407484079623177564144498319365084171295166015625*(_rpm*pow(_theta, 2)*_l_current)
 + 5.79814197724822484058030368225811201909891678951680660247802734375E-7*(_rpm*pow(_theta, 2)*_l_voltage)
 + 1.6043902139759781628729358969598361994712831801734864711761474609375E-7*(_rpm*_theta*pow(_l_current, 2))
 + -4.533662627603734121919422384028308670167461968958377838134765625E-8*(_rpm*_theta*_l_current*_l_voltage)
 + -9.21772319965103698155735323371828826566343195736408233642578125E-8*(_rpm*_theta*pow(_l_voltage, 2))
 + -1.8697061307591483774145674386091275920307452906854450702667236328125E-7*(_rpm*pow(_l_current, 3))
 + 1.845473844487605251501994262086636666708727716468274593353271484375E-7*(_rpm*pow(_l_current, 2)*_l_voltage)
 + -7.45526986159304058817296422499720787158139501116238534450531005859375E-8*(_rpm*_l_current*pow(_l_voltage, 2))
 + 1.07898586679551676211809285721443529837415553629398345947265625E-8*(_rpm*pow(_l_voltage, 3))
 + -4.140970973490104365188966932531666742534071090631186962127685546875E-7*(pow(_theta, 4))
 + -0.000001791021809492458500756768315087530396567672141827642917633056640625*(pow(_theta, 3)*_l_current)
 + 0.0000020780279050343100792955751410229225939474417828023433685302734375*(pow(_theta, 3)*_l_voltage)
 + 0.0000012321060670569711315383044925031441607643500901758670806884765625*(pow(_theta, 2)*pow(_l_current, 2))
 + 0.000001473679718409706747186786734982177904385025613009929656982421875*(pow(_theta, 2)*_l_current*_l_voltage)
 + -4.3777846769186814902363562296283561181553523056209087371826171875E-7*(pow(_theta, 2)*pow(_l_voltage, 2))
 + -5.206400851091037325015872957133244991467790896422229707241058349609375E-8*(_theta*pow(_l_current, 3))
 + 1.7176236398895806854786422429408332401834513802896253764629364013671875E-8*(_theta*pow(_l_current, 2)*_l_voltage)
 + -1.57749295980925989637386652915396201279918386717326939105987548828125E-8*(_theta*_l_current*pow(_l_voltage, 2))
 + 1.7873926411233822247537285539398244083031386253423988819122314453125E-8*(_theta*pow(_l_voltage, 3))
 + -1.4118514974320141303274476519968860799281173967756330966949462890625E-8*(pow(_l_current, 4))
 + -3.11633353441513890905926846552898012987498077563941478729248046875E-8*(pow(_l_current, 3)*_l_voltage)
 + 5.47037607688592848766942662586121315371201490052044391632080078125E-8*(pow(_l_current, 2)*pow(_l_voltage, 2))
 + -2.26487883306673210527461444219188280158050474710762500762939453125E-8*(_l_current*pow(_l_voltage, 3))
 + 2.82626944035956299347968172230860517402106779627501964569091796875E-9*(pow(_l_voltage, 4))
 + -1.4754049204089114515070502164917343179695308208465576171875E-11*(pow(_rpm, 5))
 + 3.083940881524973006756230875513580258484580554068088531494140625E-10*(pow(_rpm, 4)*_theta)
 + -2.31765065106703978259350407142846961505711078643798828125E-11*(pow(_rpm, 4)*_l_current)
 + 3.836272654042567772057770181248770313686691224575042724609375E-11*(pow(_rpm, 4)*_l_voltage)
 + 5.62086369751212434355512603811888538984931074082851409912109375E-10*(pow(_rpm, 3)*pow(_theta, 2))
 + -9.63236306314975694966608321667678183075622655451297760009765625E-11*(pow(_rpm, 3)*_theta*_l_current)
 + -4.577865253413824605708236370471553300376399420201778411865234375E-10*(pow(_rpm, 3)*_theta*_l_voltage)
 + -6.4226153403471923316638003687017999254749156534671783447265625E-10*(pow(_rpm, 3)*pow(_l_current, 2))
 + 5.378119972148308100654175156751790609632735140621662139892578125E-10*(pow(_rpm, 3)*_l_current*_l_voltage)
 + -1.3533535348354318122131301205257614128640852868556976318359375E-10*(pow(_rpm, 3)*pow(_l_voltage, 2))
 + -3.1293932121317386081042581646993738786477479152381420135498046875E-8*(pow(_rpm, 2)*pow(_theta, 3))
 + 1.23686035145172587546534559432842570458888076245784759521484375E-9*(pow(_rpm, 2)*pow(_theta, 2)*_l_current)
 + -1.186950604328123402950341536143952225756947882473468780517578125E-9*(pow(_rpm, 2)*pow(_theta, 2)*_l_voltage)
 + 5.32160966491976249499056862701795722614406258799135684967041015625E-9*(pow(_rpm, 2)*_theta*pow(_l_current, 2))
 + -3.99523205666517890644225119434196358270128257572650909423828125E-9*(pow(_rpm, 2)*_theta*_l_current*_l_voltage)
 + 1.047463637528011376628088446860687099615461193025112152099609375E-9*(pow(_rpm, 2)*_theta*pow(_l_voltage, 2))
 + 2.1963778098024223928153020324316457845270633697509765625E-8*(pow(_rpm, 2)*pow(_l_current, 3))
 + -2.45937858512675323210505511084544849609301309101283550262451171875E-8*(pow(_rpm, 2)*pow(_l_current, 2)*_l_voltage)
 + 9.140060300310125381527404098136457832879386842250823974609375E-9*(pow(_rpm, 2)*_l_current*pow(_l_voltage, 2))
 + -1.1175564612573248338654730016372695899917744100093841552734375E-9*(pow(_rpm, 2)*pow(_l_voltage, 3))
 + 3.9921965265426228303808318942369481874266057275235652923583984375E-8*(_rpm*pow(_theta, 4))
 + 9.53874625496472109144308580697124710923162638209760189056396484375E-8*(_rpm*pow(_theta, 3)*_l_current)
 + -1.058094176910269172838495455035712211611098609864711761474609375E-8*(_rpm*pow(_theta, 3)*_l_voltage)
 + -1.06212560412415860273960266368931115721352398395538330078125E-7*(_rpm*pow(_theta, 2)*pow(_l_current, 2))
 + 8.089136949099902740094834852069283215314499102532863616943359375E-8*(_rpm*pow(_theta, 2)*_l_current*_l_voltage)
 + -1.510171895913368935956445915369528165683732368052005767822265625E-8*(_rpm*pow(_theta, 2)*pow(_l_voltage, 2))
 + -1.10078458548577720358340424622323183712069294415414333343505859375E-7*(_rpm*_theta*pow(_l_current, 3))
 + 1.241566838122872383571768627186227007541674538515508174896240234375E-7*(_rpm*_theta*pow(_l_current, 2)*_l_voltage)
 + -4.66921725550712723401916050269822022755761281587183475494384765625E-8*(_rpm*_theta*_l_current*pow(_l_voltage, 2))
 + 5.77526740540524113076974350999837071185538661666214466094970703125E-9*(_rpm*_theta*pow(_l_voltage, 3))
 + 2.702384208930972483371003335650417653823751606978476047515869140625E-8*(_rpm*pow(_l_current, 4))
 + -5.9832517449161400679481272180115780656706192530691623687744140625E-8*(_rpm*pow(_l_current, 3)*_l_voltage)
 + 4.47595362122942459859949344835872153680611518211662769317626953125E-8*(_rpm*pow(_l_current, 2)*pow(_l_voltage, 2))
 + -1.401794188641357815791217418348313383802405951428227126598358154296875E-8*(_rpm*_l_current*pow(_l_voltage, 3))
 + 1.5812735178422251586835382830553697885989095084369182586669921875E-9*(_rpm*pow(_l_voltage, 4))
 + 2.7583272132601760748268969296315145101061716559343039989471435546875E-8*(pow(_theta, 5))
 + 8.9139141486220122687533957972494391697182436473667621612548828125E-8*(pow(_theta, 4)*_l_current)
 + -5.627349870810132969061075070005273346396279521286487579345703125E-8*(pow(_theta, 4)*_l_voltage)
 + -2.7373725498720123610899772163829180016136888298206031322479248046875E-7*(pow(_theta, 3)*pow(_l_current, 2))
 + 1.6668503187798892433197262170907482214943229337222874164581298828125E-7*(pow(_theta, 3)*_l_current*_l_voltage)
 + -2.908281473234848132805412113111032113010878674685955047607421875E-8*(pow(_theta, 3)*pow(_l_voltage, 2))
 + 3.25297903877251268968287360727753565470266039483249187469482421875E-7*(pow(_theta, 2)*pow(_l_current, 3))
 + -3.27406378166410933435478795849871147538578952662646770477294921875E-7*(pow(_theta, 2)*pow(_l_current, 2)*_l_voltage)
 + 1.076111675013455601691305350831040499315349734388291835784912109375E-7*(pow(_theta, 2)*_l_current*pow(_l_voltage, 2))
 + -1.150561072809092513368096899473158600812894292175769805908203125E-8*(pow(_theta, 2)*pow(_l_voltage, 3))
 + 5.01579868421954564461644372752591181097159278579056262969970703125E-7*(_theta*pow(_l_current, 4))
 + -7.2579701695123459884270884778789678648536209948360919952392578125E-7*(_theta*pow(_l_current, 3)*_l_voltage)
 + 3.92509537773147983974182488597914897354712593369185924530029296875E-7*(_theta*pow(_l_current, 2)*pow(_l_voltage, 2))
 + -9.397616285296260066361474783125373733128071762621402740478515625E-8*(_theta*_l_current*pow(_l_voltage, 3))
 + 8.407889314868959655647172313219783745807944796979427337646484375E-9*(_theta*pow(_l_voltage, 4))
 + -6.198668493405364766736845814898426709760315134190022945404052734375E-8*(pow(_l_current, 5))
 + 1.049824562356505412390856278592732309107304899953305721282958984375E-7*(pow(_l_current, 4)*_l_voltage)
 + -6.5995625913518065834738259185787700999981097993440926074981689453125E-8*(pow(_l_current, 3)*pow(_l_voltage, 2))
 + 1.827516576590313846848562771840729368477695970796048641204833984375E-8*(pow(_l_current, 2)*pow(_l_voltage, 3))
 + -1.8809277576840228975312593710789155210250100935809314250946044921875E-9*(_l_current*pow(_l_voltage, 4))
 + -5.8986910966242605820590572118788941224920563399791717529296875E-13*(pow(_l_voltage, 5));
}
