/*
  WS_EST.cpp 
*/

#include "Arduino.h"
#include "WS_EST_ptr.h"

WindspeedEstimation::WindspeedEstimation(uint16_t *rpm, float *theta, uint16_t *l_current, uint16_t *l_voltage, uint16_t *l_power)
{
    _ptrrpm = rpm;
    _ptrtheta = theta;
    _ptrl_voltage = l_voltage;
    _ptrl_current = l_current;
    _ptrl_power = l_power;
}

void WindspeedEstimation::updateVars()
{
    _rpm = (double)*_ptrrpm;
    _theta = (double)*_ptrtheta;
    _l_voltage = (double)*_ptrl_voltage;
    _l_current = (double)*_ptrl_current;
    _l_power = (double)*_ptrl_power;
}

double WindspeedEstimation::linear()
{
    updateVars();
    return 0.00328831124563338*(_rpm)
            + 0.0236602202015669*(_l_voltage)
            + -0.0591897365414463*(_l_current)
            + 0.128589853702955*(_theta)
            + -0.000239889103686202*(_l_power);
}

double WindspeedEstimation::secondOrder()
{
    updateVars();
    return -2.2072515
            + 0.0*(1)
            + 0.03016279*(_rpm)
            + -0.00182036*(_theta)
            + -0.0035850275*(_l_current)
            + -0.008176723*(_l_voltage)
            + 5.0407834e-06*(pow(_rpm, 2))
            + -0.0006336755*(_rpm*_theta)
            + 0.00024348474*(_rpm*_l_current)
            + -0.000100869685*(_rpm*_l_voltage)
            + 0.0037005555*(pow(_theta, 2))
            + -0.0011665636*(_theta*_l_current)
            + 0.000711424*(_theta*_l_voltage)
            + 0.001034786*(pow(_l_current, 2))
            + -0.00090177264*(_l_current*_l_voltage)
            + 0.00019574724*(pow(_l_voltage, 2));
}

double WindspeedEstimation::bestFit()
{
    updateVars();
    return 3.088711921718726
            + 3.3858034475895587e-10*(1)
            + -5.237892911234304e-11*(_rpm)
            + -2.3823995260602403e-11*(_theta)
            + 6.781545514522471e-14*(_l_current)
            + 1.9113310965100905e-11*(_l_voltage)
            + -2.2370320796633863e-11*(pow(_rpm, 2))
            + -3.1935495476833454e-12*(_rpm*_theta)
            + -3.9678559800139997e-13*(_rpm*_l_current)
            + -8.199129119862107e-13*(_rpm*_l_voltage)
            + 3.0682362460726193e-12*(pow(_theta, 2))
            + 1.9215108888548436e-12*(_theta*_l_current)
            + -4.730911954449068e-12*(_theta*_l_voltage)
            + 2.4496211039537178e-12*(pow(_l_current, 2))
            + -1.0713282799171298e-12*(_l_current*_l_voltage)
            + -1.881138728688231e-12*(pow(_l_voltage, 2))
            + 3.9964123702957186e-11*(pow(_rpm, 3))
            + -2.5331819968750526e-13*(pow(_rpm, 2)*_theta)
            + 2.8069430042389795e-11*(pow(_rpm, 2)*_l_current)
            + 6.334391201716398e-11*(pow(_rpm, 2)*_l_voltage)
            + -4.2476993662604327e-13*(_rpm*pow(_theta, 2))
            + -1.3677132006784687e-12*(_rpm*_theta*_l_current)
            + -4.573228793705529e-12*(_rpm*_theta*_l_voltage)
            + 1.9773286085418e-11*(_rpm*pow(_l_current, 2))
            + 5.0353331878129855e-11*(_rpm*_l_current*_l_voltage)
            + 1.0755431702749296e-10*(_rpm*pow(_l_voltage, 2))
            + 6.146853430612621e-13*(pow(_theta, 3))
            + 1.0148377133636144e-12*(pow(_theta, 2)*_l_current)
            + 1.0882809699913772e-12*(pow(_theta, 2)*_l_voltage)
            + -6.251246547954041e-13*(_theta*pow(_l_current, 2))
            + -2.1981995329328606e-12*(_theta*_l_current*_l_voltage)
            + -9.13529457839687e-12*(_theta*pow(_l_voltage, 2))
            + 1.470594392566161e-11*(pow(_l_current, 3))
            + 3.6667513386435027e-11*(pow(_l_current, 2)*_l_voltage)
            + 7.850172941819603e-11*(_l_current*pow(_l_voltage, 2))
            + 1.6846562088473301e-10*(pow(_l_voltage, 3))
            + 6.235625685886795e-10*(pow(_rpm, 4))
            + 6.185351710360319e-11*(pow(_rpm, 3)*_theta)
            + -4.877332970999463e-11*(pow(_rpm, 3)*_l_current)
            + -8.42209137155553e-12*(pow(_rpm, 3)*_l_voltage)
            + 4.195434251535491e-11*(pow(_rpm, 2)*pow(_theta, 2))
            + 1.0751445099132333e-10*(pow(_rpm, 2)*_theta*_l_current)
            + -1.7176161426139747e-11*(pow(_rpm, 2)*_theta*_l_voltage)
            + -1.428108385624057e-10*(pow(_rpm, 2)*pow(_l_current, 2))
            + -2.1448401821561998e-10*(pow(_rpm, 2)*_l_current*_l_voltage)
            + -4.958267686217042e-10*(pow(_rpm, 2)*pow(_l_voltage, 2))
            + -8.659039649696795e-12*(_rpm*pow(_theta, 3))
            + 5.347680357349096e-11*(_rpm*pow(_theta, 2)*_l_current)
            + 1.2167465270456306e-10*(_rpm*pow(_theta, 2)*_l_voltage)
            + 1.7961152714239273e-10*(_rpm*_theta*pow(_l_current, 2))
            + 1.9724924227544308e-10*(_rpm*_theta*_l_current*_l_voltage)
            + -1.9029543478207292e-10*(_rpm*_theta*pow(_l_voltage, 2))
            + -9.641622671325735e-11*(_rpm*pow(_l_current, 3))
            + -3.0921706245302916e-11*(_rpm*pow(_l_current, 2)*_l_voltage)
            + 1.7189447525704988e-10*(_rpm*_l_current*pow(_l_voltage, 2))
            + 2.7784308226478786e-10*(_rpm*pow(_l_voltage, 3))
            + 2.1226793303924943e-13*(pow(_theta, 4))
            + -6.782208574907016e-12*(pow(_theta, 3)*_l_current)
            + -1.8699583942412393e-11*(pow(_theta, 3)*_l_voltage)
            + 6.303174200154746e-11*(pow(_theta, 2)*pow(_l_current, 2))
            + 1.480553305344899e-10*(pow(_theta, 2)*_l_current*_l_voltage)
            + 3.4373285306804225e-10*(pow(_theta, 2)*pow(_l_voltage, 2))
            + 2.687250028870859e-10*(_theta*pow(_l_current, 3))
            + 4.532774822726985e-10*(_theta*pow(_l_current, 2)*_l_voltage)
            + 5.388639630078625e-10*(_theta*_l_current*pow(_l_voltage, 2))
            + -2.6640913725527055e-10*(_theta*pow(_l_voltage, 3))
            + -1.9883976445337193e-10*(pow(_l_current, 4))
            + -2.2045154355451272e-10*(pow(_l_current, 3)*_l_voltage)
            + -9.579438349196742e-11*(pow(_l_current, 2)*pow(_l_voltage, 2))
            + 2.3240269545969813e-10*(_l_current*pow(_l_voltage, 3))
            + -1.1028119911345335e-10*(pow(_l_voltage, 4))
            + 8.225302821347304e-11*(pow(_rpm, 5))
            + 6.993039964548847e-11*(pow(_rpm, 4)*_theta)
            + -1.0057624035008544e-10*(pow(_rpm, 4)*_l_current)
            + -1.3743930998141451e-10*(pow(_rpm, 4)*_l_voltage)
            + 1.0474539488495055e-10*(pow(_rpm, 3)*pow(_theta, 2))
            + -7.148928886791624e-11*(pow(_rpm, 3)*_theta*_l_current)
            + -9.460646391748113e-11*(pow(_rpm, 3)*_theta*_l_voltage)
            + 1.132249704728776e-10*(pow(_rpm, 3)*pow(_l_current, 2))
            + 1.0769194090325808e-10*(pow(_rpm, 3)*_l_current*_l_voltage)
            + 9.204320062498377e-11*(pow(_rpm, 3)*pow(_l_voltage, 2))
            + -2.9734900310838825e-10*(pow(_rpm, 2)*pow(_theta, 3))
            + 2.2498987185952182e-11*(pow(_rpm, 2)*pow(_theta, 2)*_l_current)
            + 3.13279588443321e-11*(pow(_rpm, 2)*pow(_theta, 2)*_l_voltage)
            + -1.2630829935584522e-11*(pow(_rpm, 2)*_theta*pow(_l_current, 2))
            + 1.5650577021088313e-11*(pow(_rpm, 2)*_theta*_l_current*_l_voltage)
            + 7.395555450625133e-11*(pow(_rpm, 2)*_theta*pow(_l_voltage, 2))
            + -4.305002546722126e-11*(pow(_rpm, 2)*pow(_l_current, 3))
            + -2.3889811562105857e-11*(pow(_rpm, 2)*pow(_l_current, 2)*_l_voltage)
            + -1.0179588995718277e-10*(pow(_rpm, 2)*_l_current*pow(_l_voltage, 2))
            + -1.8669281515711288e-11*(pow(_rpm, 2)*pow(_l_voltage, 3))
            + -2.421092564625764e-10*(_rpm*pow(_theta, 4))
            + -9.851262459848521e-12*(_rpm*pow(_theta, 3)*_l_current)
            + -3.399091302862675e-10*(_rpm*pow(_theta, 3)*_l_voltage)
            + -1.41253654757021e-11*(_rpm*pow(_theta, 2)*pow(_l_current, 2))
            + -1.2909008852935323e-11*(_rpm*pow(_theta, 2)*_l_current*_l_voltage)
            + -7.595991014681456e-11*(_rpm*pow(_theta, 2)*pow(_l_voltage, 2))
            + 3.3127545017603944e-12*(_rpm*_theta*pow(_l_current, 3))
            + 8.857568572121531e-12*(_rpm*_theta*pow(_l_current, 2)*_l_voltage)
            + 2.810459032784884e-11*(_rpm*_theta*_l_current*pow(_l_voltage, 2))
            + -3.4042914289921947e-11*(_rpm*_theta*pow(_l_voltage, 3))
            + -5.853167098816932e-11*(_rpm*pow(_l_current, 4))
            + 1.2336752902599513e-12*(_rpm*pow(_l_current, 3)*_l_voltage)
            + 5.93513082295184e-11*(_rpm*pow(_l_current, 2)*pow(_l_voltage, 2))
            + 1.0869193479763127e-11*(_rpm*_l_current*pow(_l_voltage, 3))
            + 1.7508722796316564e-12*(_rpm*pow(_l_voltage, 4))
            + 1.2332191674093357e-11*(pow(_theta, 5))
            + -1.9205158873435855e-10*(pow(_theta, 4)*_l_current)
            + -5.278902142776182e-10*(pow(_theta, 4)*_l_voltage)
            + 2.3578254738147956e-10*(pow(_theta, 3)*pow(_l_current, 2))
            + 3.2734774617738236e-10*(pow(_theta, 3)*_l_current*_l_voltage)
            + 1.049778520816448e-10*(pow(_theta, 3)*pow(_l_voltage, 2))
            + -3.540945810994227e-11*(pow(_theta, 2)*pow(_l_current, 3))
            + -2.3331383339154975e-11*(pow(_theta, 2)*pow(_l_current, 2)*_l_voltage)
            + 2.17787617408728e-11*(pow(_theta, 2)*_l_current*pow(_l_voltage, 2))
            + 1.674990801424556e-11*(pow(_theta, 2)*pow(_l_voltage, 3))
            + 2.2736270159845227e-11*(_theta*pow(_l_current, 4))
            + 8.614772886304673e-12*(_theta*pow(_l_current, 3)*_l_voltage)
            + -1.3355583340748283e-11*(_theta*pow(_l_current, 2)*pow(_l_voltage, 2))
            + -1.0070147964192379e-11*(_theta*_l_current*pow(_l_voltage, 3))
            + 7.083464365020627e-12*(_theta*pow(_l_voltage, 4))
            + -1.4992050894368185e-11*(pow(_l_current, 5))
            + 5.694933054191196e-12*(pow(_l_current, 4)*_l_voltage)
            + 1.3378504329556827e-11*(pow(_l_current, 3)*pow(_l_voltage, 2))
            + -1.08662275604942e-11*(pow(_l_current, 2)*pow(_l_voltage, 3))
            + -2.3426151390455357e-12*(_l_current*pow(_l_voltage, 4))
            + 6.102995768938907e-13*(pow(_l_voltage, 5))
            + -9.175926939906797e-15*(pow(_rpm, 6))
            + -1.2837571674856047e-12*(pow(_rpm, 5)*_theta)
            + -1.1598704799584739e-12*(pow(_rpm, 5)*_l_current)
            + 4.629809522052484e-13*(pow(_rpm, 5)*_l_voltage)
            + -1.1476764738168506e-11*(pow(_rpm, 4)*pow(_theta, 2))
            + 3.3526342631825598e-12*(pow(_rpm, 4)*_theta*_l_current)
            + 1.6333906075798672e-12*(pow(_rpm, 4)*_theta*_l_voltage)
            + 1.4413824404797938e-11*(pow(_rpm, 4)*pow(_l_current, 2))
            + -8.553372511002353e-12*(pow(_rpm, 4)*_l_current*_l_voltage)
            + 1.1459155098044731e-12*(pow(_rpm, 4)*pow(_l_voltage, 2))
            + -6.439715771350008e-11*(pow(_rpm, 3)*pow(_theta, 3))
            + 7.219293173208797e-12*(pow(_rpm, 3)*pow(_theta, 2)*_l_current)
            + 1.7599618129717538e-11*(pow(_rpm, 3)*pow(_theta, 2)*_l_voltage)
            + -1.2840994847578433e-10*(pow(_rpm, 3)*_theta*pow(_l_current, 2))
            + 9.275690809762801e-11*(pow(_rpm, 3)*_theta*_l_current*_l_voltage)
            + -1.9327343582146758e-11*(pow(_rpm, 3)*_theta*pow(_l_voltage, 2))
            + -2.151271208291104e-11*(pow(_rpm, 3)*pow(_l_current, 3))
            + 9.519623705698695e-13*(pow(_rpm, 3)*pow(_l_current, 2)*_l_voltage)
            + 6.599772909849666e-12*(pow(_rpm, 3)*_l_current*pow(_l_voltage, 2))
            + -1.4518106837022612e-12*(pow(_rpm, 3)*pow(_l_voltage, 3))
            + 4.410638012198521e-10*(pow(_rpm, 2)*pow(_theta, 4))
            + 2.1560607965153737e-12*(pow(_rpm, 2)*pow(_theta, 3)*_l_current)
            + 6.787765585639734e-11*(pow(_rpm, 2)*pow(_theta, 3)*_l_voltage)
            + -3.1871464293445486e-13*(pow(_rpm, 2)*pow(_theta, 2)*pow(_l_current, 2))
            + -6.724030819408143e-12*(pow(_rpm, 2)*pow(_theta, 2)*_l_current*_l_voltage)
            + -1.0830985237944025e-11*(pow(_rpm, 2)*pow(_theta, 2)*pow(_l_voltage, 2))
            + 8.643577047702638e-11*(pow(_rpm, 2)*_theta*pow(_l_current, 3))
            + 6.607463123579777e-11*(pow(_rpm, 2)*_theta*pow(_l_current, 2)*_l_voltage)
            + -8.51604139453123e-11*(pow(_rpm, 2)*_theta*_l_current*pow(_l_voltage, 2))
            + 1.9254844908039656e-11*(pow(_rpm, 2)*_theta*pow(_l_voltage, 3))
            + 1.7017001630079002e-11*(pow(_rpm, 2)*pow(_l_current, 4))
            + 7.864681362213246e-12*(pow(_rpm, 2)*pow(_l_current, 3)*_l_voltage)
            + -9.410593966714973e-12*(pow(_rpm, 2)*pow(_l_current, 2)*pow(_l_voltage, 2))
            + 8.440672896961917e-13*(pow(_rpm, 2)*_l_current*pow(_l_voltage, 3))
            + 2.473981361650501e-13*(pow(_rpm, 2)*pow(_l_voltage, 4))
            + -4.2888028665307584e-10*(_rpm*pow(_theta, 5))
            + -1.2577946674108842e-10*(_rpm*pow(_theta, 4)*_l_current)
            + -2.9827036234463496e-10*(_rpm*pow(_theta, 4)*_l_voltage)
            + 1.513621307555734e-11*(_rpm*pow(_theta, 3)*pow(_l_current, 2))
            + -6.101999823792115e-12*(_rpm*pow(_theta, 3)*_l_current*_l_voltage)
            + -2.3688418519499806e-11*(_rpm*pow(_theta, 3)*pow(_l_voltage, 2))
            + -1.636608042470516e-11*(_rpm*pow(_theta, 2)*pow(_l_current, 3))
            + -4.5579873325100176e-11*(_rpm*pow(_theta, 2)*pow(_l_current, 2)*_l_voltage)
            + 4.442406563431156e-11*(_rpm*pow(_theta, 2)*_l_current*pow(_l_voltage, 2))
            + -5.484394000251809e-12*(_rpm*pow(_theta, 2)*pow(_l_voltage, 3))
            + -4.676598287494673e-11*(_rpm*_theta*pow(_l_current, 4))
            + -4.007654943178848e-11*(_rpm*_theta*pow(_l_current, 3)*_l_voltage)
            + 1.6793539309745686e-11*(_rpm*_theta*pow(_l_current, 2)*pow(_l_voltage, 2))
            + 1.4320460956610108e-11*(_rpm*_theta*_l_current*pow(_l_voltage, 3))
            + -4.9562770992714166e-12*(_rpm*_theta*pow(_l_voltage, 4))
            + 1.1745796352550025e-11*(_rpm*pow(_l_current, 5))
            + 1.219356981206605e-11*(_rpm*pow(_l_current, 4)*_l_voltage)
            + -5.359207607337159e-11*(_rpm*pow(_l_current, 3)*pow(_l_voltage, 2))
            + 4.0286509377159726e-11*(_rpm*pow(_l_current, 2)*pow(_l_voltage, 3))
            + -1.1478008535025815e-11*(_rpm*_l_current*pow(_l_voltage, 4))
            + 1.1384603225531329e-12*(_rpm*pow(_l_voltage, 5))
            + 7.067169136497952e-10*(pow(_theta, 6))
            + 2.995213276012094e-10*(pow(_theta, 5)*_l_current)
            + 5.12399720128087e-11*(pow(_theta, 5)*_l_voltage)
            + -3.95658680515449e-12*(pow(_theta, 4)*pow(_l_current, 2))
            + 4.20503621602865e-11*(pow(_theta, 4)*_l_current*_l_voltage)
            + 5.153818177729221e-11*(pow(_theta, 4)*pow(_l_voltage, 2))
            + -9.56807269876374e-12*(pow(_theta, 3)*pow(_l_current, 3))
            + -9.36017234215186e-12*(pow(_theta, 3)*pow(_l_current, 2)*_l_voltage)
            + 8.396376383153911e-12*(pow(_theta, 3)*_l_current*pow(_l_voltage, 2))
            + 1.3423462790847957e-12*(pow(_theta, 3)*pow(_l_voltage, 3))
            + 1.224120835172778e-10*(pow(_theta, 2)*pow(_l_current, 4))
            + 1.167062190613676e-11*(pow(_theta, 2)*pow(_l_current, 3)*_l_voltage)
            + -9.496441484941912e-11*(pow(_theta, 2)*pow(_l_current, 2)*pow(_l_voltage, 2))
            + 3.982837623138784e-11*(pow(_theta, 2)*_l_current*pow(_l_voltage, 3))
            + -5.040523080957305e-12*(pow(_theta, 2)*pow(_l_voltage, 4))
            + 1.889982572049352e-11*(_theta*pow(_l_current, 5))
            + 6.826618161629103e-12*(_theta*pow(_l_current, 4)*_l_voltage)
            + -6.595403837355567e-12*(_theta*pow(_l_current, 3)*pow(_l_voltage, 2))
            + 8.59316636559982e-13*(_theta*pow(_l_current, 2)*pow(_l_voltage, 3))
            + -1.2241482326872507e-12*(_theta*_l_current*pow(_l_voltage, 4))
            + 4.3444487253252175e-13*(_theta*pow(_l_voltage, 5))
            + -7.724844952958683e-11*(pow(_l_current, 6))
            + 5.702803614410155e-11*(pow(_l_current, 5)*_l_voltage)
            + 4.50317536342892e-11*(pow(_l_current, 4)*pow(_l_voltage, 2))
            + -6.28155334274593e-11*(pow(_l_current, 3)*pow(_l_voltage, 3))
            + 2.583412083550788e-11*(pow(_l_current, 2)*pow(_l_voltage, 4))
            + -4.564373858887837e-12*(_l_current*pow(_l_voltage, 5))
            + 2.925192448667288e-13*(pow(_l_voltage, 6));
}
